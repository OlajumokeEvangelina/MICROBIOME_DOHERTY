---
title: "Microbiome Analysis"
output: pdf_document
author: "Olajumoke Evangelina Owokotomo"
date: "4/30/2019"
header-includes:
- \newcommand{\bcenter}{\begin{center}}
- \newcommand{\ecenter}{\end{center}}
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library("Biobase")
library("grid")
library("ggplot2")
library("nlme")
library(stringr)
library(dplyr)
library(phyloseq)
library(tidyr)
```


## General information

* The dataset is a large phyloseq object saved as R datafile.
* The metadata has been converted to phyloseq format.
* The sample are Crohn's disease patients.
* The CDAI is the standard instrument for evaluating clinical symptoms and disease activity in Crohn's disease.
* Samples are randomized to take PlaceboIV or UstekinumabIV ni the trial.
* Taxonomic assignment of the OTU into 6 taxonomic ranks (Tax data) which are;
"Kingdom" "Phylum"  "Class"   "Order"   "Family"  "Genus".
* OTU Table contains 2353 taxa and 992 samples for all time point (OTU table).
* 83 information was obtained about the samples which includes their age, sex, race , country, treatment information, CDAI etc. 
* 306 samples information was obtained by baseline, 236 at week4, 261 at week 6 and 189 at week 22. No information about week 8.
* Difference in a subject’s initial Crohn’s disease activity index (CDAI) at baseline and other time point $\Delta_4 - \Delta_0$, $\Delta_6 - \Delta_0$, $\Delta_8 - \Delta_0$, $\Delta_{22} - \Delta_0$.
* Placebo samples were coded as 0 while treated samples were coded as 1.



```{r first, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
load("C:/Users/lucp2490.LP2490-02/Desktop/EVANGELINA/PHD FOLDER/PHD/DEA/certifi_ori.rda")
OTU <- data.frame(certifi_ori@otu_table)
TAX <- data.frame(certifi_ori@tax_table)
SAMPEL <- data.frame(certifi_ori@sam_data)
SAMPEL$Treatment= ifelse(SAMPEL$TRTGR=="Placebo",0,1)



Screening_response <- SAMPEL %>% filter(visit == "Screening") %>% select(c("USUBJID", "AGE","SEX","RACE","COUNTRY","Treatment",
                "deltaCDAIwk0_22","deltaCDAIwk0_8","deltaCDAIwk0_6","deltaCDAIwk0_4","deltaCDAIwk8_22",
                "percentdelta0_4"))


Week4_response <- SAMPEL %>% filter(visit == "Week 4") %>% select(c("USUBJID", "AGE","SEX","RACE","COUNTRY","Treatment",
              "deltaCDAIwk0_22","deltaCDAIwk0_8","deltaCDAIwk0_6","deltaCDAIwk0_4","deltaCDAIwk8_22",
              "percentdelta0_4"))



Week6_response <- SAMPEL %>% filter(visit == "Week 6") %>% select(c("USUBJID", "AGE","SEX","RACE","COUNTRY","Treatment",
            "deltaCDAIwk0_22","deltaCDAIwk0_8","deltaCDAIwk0_6","deltaCDAIwk0_4","deltaCDAIwk8_22",
           "percentdelta0_4"))



Week22_response <- SAMPEL %>% filter(visit == "Week 22") %>% select(c("USUBJID", "AGE","SEX","RACE","COUNTRY","Treatment",
                      "deltaCDAIwk0_22","deltaCDAIwk0_8","deltaCDAIwk0_6","deltaCDAIwk0_4","deltaCDAIwk8_22",
                       "percentdelta0_4"))

otu = as.data.frame(t(OTU))
otu$visit = SAMPEL$visit
Screening_otu <- otu %>% filter(visit == "Screening") %>% select(-c("visit"))  %>% data.frame()
Week4_otu <- otu %>% filter(visit == "Week 4") %>% select(-c("visit"))  %>% data.frame()
Week6_otu <- otu %>% filter(visit == "Week 6") %>% select(-c("visit"))  %>% data.frame()
Week22_otu <- otu %>% filter(visit == "Week 22") %>% select(-c("visit"))  %>% data.frame()



freq_zero = data.frame(otunames = colnames(Week22_otu), Full_data = as.vector(apply(otu[,-2354] == 0, 2, sum)),
Screening = as.vector(apply(Screening_otu == 0, 2, sum)), week4 = as.vector(apply(Week4_otu == 0, 2, sum)),
week6 = as.vector(apply(Week6_otu == 0, 2, sum)), week22 = as.vector(apply(Week22_otu == 0, 2, sum)),
otunumber = 1:dim(Week4_otu)[2])

prop_zero = data.frame(otunames = colnames(Week22_otu), Full_data = freq_zero$Full_data/dim(otu)[1], Screening = freq_zero$Screening/dim(Screening_response)[1], 
                      week4 = freq_zero$week4/dim(Week4_otu)[1], week6 = freq_zero$week6/dim(Week6_otu)[1],
                      week22 = freq_zero$week22/dim(Week22_otu)[1],otunumber = 1:dim(Week4_otu)[2])


```

## Frequency and proportion of zero samples per OTU
### At all timepoints
```{r g1, echo=FALSE,fig.width=12,fig.height=7,fig.show='hold',fig.align='center', message=FALSE, warning=FALSE, cache=TRUE}

ggplot(prop_zero, aes(x=otunumber, y=Full_data)) +
  geom_point() + xlab("OTU number") +  
  scale_y_continuous(breaks  = c(0,50,100,150,200,250,300,350,400,450,500,550,600,650,700,750,800,850,900,950,1000),
  labels = c(0,50,100,150,200,250,300,350,400,450,500,550,600,650,700,750,800,850,900,950,1000))


```